{% extends 'base.html' %}
{% load static %}

{% block title %}
<title>Realive</title>
{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/live.css' %}">
<style type="text/css">
    #stream, #snapshot {
        display: none;
    }

    {% if not request.user.is_authenticated %}
    #openDetection, #closeDetection {
        display: none;
    }
    {% endif %}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mainArea">
    <div class="row">
        <div class="col-md-7">
            <div id="player"></div>
            <input id="openDetection" class="btn btn-primary" type="button" onclick="onOpenDetectionButtonClick()" value="開啟情緒分享" />
            <input id="closeDetection" class="btn btn-primary" type="button" onclick="onCloseDetectionButtonClick()" value="關閉情緒分享" />
            <input class="btn btn-primary" type="button" onclick="location.href='/statistics/{{streamerName}}'" value="查看直播紀錄" />
        </div>
        <div class="col-md-5">
            <textarea readonly class="form-control" rows="16" id="chat-log"></textarea>
            <input id="chat-message-input" type="text" size="25" />
            <input id="chat-message-submit"class="btn btn-primary" type="button" value="發送" />
        </div>
    </div>
    <video id="stream" controls autoplay></video>
    <canvas id="snapshot" width=320 height=240></canvas>
    <img id="test">
</div>
{% endblock %}

{% block js %}
<!-- Setting Youtube IFrame Player API -->
<script type="text/javascript">
var vid = '{{ youtubeUrl }}';

// This code loads the IFrame Player API code asynchronously
var tag = document.createElement('script');
tag.src = "http://www.youtube.com/iframe_api";

// Inserting this script
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

// This function creates an <iframe> (and YouTube player) after the API code downloads
var player;
function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
        width: '100%',
        videoId: '{{ youtubeUrl }}',
        events: {
            'onReady': onPlayerReady,
        }
    });
}

function onPlayerReady(event) {
    event.target.playVideo();
}
</script>

<script src="{% static 'js/live.js' %}"></script>
<script src="{% static 'js/chatChannel.js' %}"></script>
{% endblock %}
